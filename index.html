<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NetTestTool Pro</title>
    <script src="chart.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="app-container">
    <div class="sidebar">
        <div class="brand">NetTool 🛠️</div>
        <ul class="nav">
            <li class="active" onclick="showTab('info')">📊 网络信息</li>
            <li onclick="showTab('scan')">🔎 网段扫描</li>
            <li onclick="showTab('ping')">📡 Ping 测试</li>
            <li onclick="showTab('arp')">📋 ARP 表</li>
            <li onclick="showTab('throughput')">⚡ 带宽吞吐量</li>
            <li onclick="showTab('transfer')">📁 文件传输</li>
        </ul>
    </div>

    <div class="main-content">
        <div id="info" class="tab-pane active">
            <h2>本机网络环境</h2>
            <div id="interface-list" class="card-grid">
            </div>
        </div>

        <div id="scan" class="tab-pane">
            <h2>网段扫描 (局域网设备发现)</h2>

            <div class="control-bar">
                <div class="input-group-row">
                    <div class="form-control">
                        <label for="scan-interface">选择网络接口</label>
                        <select id="scan-interface">
                            <option value="">加载中...</option>
                        </select>
                    </div>
                    <button class="btn-primary" id="btn-scan" onclick="toggleScan()">开始扫描</button>
                </div>
                <div style="margin-top: 15px;">
                    <p style="color: var(--text-muted); font-size: 13px;">
                        💡 提示：扫描将检测当前网段内的所有在线设备，显示IP、MAC地址、厂商信息和响应时间
                    </p>
                </div>
            </div>

            <div id="scan-progress" class="scan-progress" style="display: none;">
                <div class="progress-info">
                    <span id="scan-progress-text">准备扫描...</span>
                    <span id="scan-progress-percent">0%</span>
                </div>
                <div class="progress-bar-container">
                    <div id="scan-progress-bar" class="progress-bar"></div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">扫描总数</div>
                    <div class="stat-value" id="scan-total">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">已扫描</div>
                    <div class="stat-value" id="scan-current">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">在线设备</div>
                    <div class="stat-value" id="scan-found">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">扫描状态</div>
                    <div class="stat-value" id="scan-status-text" style="font-size: 18px;">就绪</div>
                </div>
            </div>

            <div class="device-list-container">
                <div class="device-list-header">
                    <h3>发现的设备 (<span id="device-count">0</span>)</h3>
                    <button class="btn-secondary" onclick="exportDeviceList()"
                            style="padding: 8px 16px; font-size: 13px;">
                        📋 导出列表
                    </button>
                </div>
                <div class="device-table-wrapper">
                    <table class="device-table">
                        <thead>
                        <tr>
                            <th style="width: 40px;">#</th>
                            <th style="width: 150px;">IP地址</th>
                            <th style="width: 150px;">MAC地址</th>
                            <th>厂商</th>
                            <th style="width: 100px;">响应时间</th>
                            <th style="width: 120px;">操作</th>
                        </tr>
                        </thead>
                        <tbody id="device-list">
                        <tr>
                            <td colspan="6" style="text-align: center; color: var(--text-muted); padding: 40px;">
                                点击"开始扫描"发现局域网设备
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="ping" class="tab-pane">
            <h2>ICMP / Ping 测试</h2>

            <div class="control-bar">
                <div class="input-group-row">
                    <div class="form-control">
                        <label for="ping-target">目标地址 (IP/域名)</label>
                        <input type="text" id="ping-target" value="127.0.0.1" placeholder="如 127.0.0.1 或 google.com">
                    </div>
                    <div class="form-control">
                        <label for="ping-interval">间隔 (秒)</label>
                        <input type="number" id="ping-interval" value="1" min="0.1" step="0.1" placeholder="0.1 ~ 60">
                    </div>
                    <div class="form-control">
                        <label for="ping-size">包大小 (字节)</label>
                        <input type="number" id="ping-size" value="32" min="1" placeholder="1 ~ 65500">
                    </div>
                    <button class="btn-primary" onclick="togglePing()">开始 Ping</button>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">已发送</div>
                    <div class="stat-value" id="ping-sent">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">已接收</div>
                    <div class="stat-value" id="ping-received">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">丢包率</div>
                    <div class="stat-value" id="ping-loss">0%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">平均延迟</div>
                    <div class="stat-value" id="ping-avg">0ms</div>
                </div>
            </div>

            <div class="chart-container">
                <canvas id="pingChart"></canvas>
            </div>

            <div class="console-output" id="ping-output"></div>
        </div>

        <div id="arp" class="tab-pane">
            <h2>ARP 缓存表</h2>
            <div class="control-bar">
                <button class="btn-secondary" onclick="refreshArp()">🔄 刷新 ARP</button>
            </div>
            <div class="console-output" id="arp-output">等待获取...</div>
        </div>

        <div id="throughput" class="tab-pane">
            <h2>TCP/UDP 吞吐量测试</h2>

            <div class="tp-controls">
                <div class="card">
                    <h3>🔵 接收端 (Server)</h3>
                    <div class="form-control">
                        <label for="tp-server-protocol">选择协议</label>
                        <select id="tp-server-protocol" class="protocol-select">
                            <option value="tcp">TCP</option>
                            <option value="udp">UDP</option>
                        </select>
                    </div>
                    <button class="btn-secondary" onclick="startServer()">启动服务 (Port 5201)</button>
                    <p id="server-status" class="status-text">
                        <span class="status-indicator inactive"></span>未启动
                    </p>
                </div>

                <div class="card">
                    <h3>🟢 发送端 (Client)</h3>
                    <div class="form-control">
                        <label for="tp-ip">服务端 IP</label>
                        <input type="text" id="tp-ip" placeholder="如 192.168.1.1" value="127.0.0.1">
                    </div>
                    <div class="form-control">
                        <label for="tp-client-protocol">选择协议</label>
                        <select id="tp-client-protocol" class="protocol-select" onchange="toggleUdpConfig()">
                            <option value="tcp">TCP</option>
                            <option value="udp">UDP</option>
                        </select>
                    </div>

                    <div id="udp-config" style="display: none;">
                        <h4>UDP 模式配置</h4>
                        <div class="form-control">
                            <label for="tp-udp-bandwidth">目标带宽 (Mbps)</label>
                            <input type="number" id="tp-udp-bandwidth" value="10" min="1" placeholder="目标发送速率">
                        </div>
                        <div class="form-control">
                            <label for="tp-udp-size">数据包大小 (字节)</label>
                            <input type="number" id="tp-udp-size" value="1470" min="1"
                                   placeholder="建议 1470 (以太网 MTU-IP头-UDP头)">
                        </div>
                    </div>

                    <button class="btn-primary" id="btn-tp-client" onclick="toggleClient()">开始测试</button>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">当前速率</div>
                    <div class="stat-value" id="current-speed">0 Mbps</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">平均速率</div>
                    <div class="stat-value" id="avg-speed">0 Mbps</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">峰值速率</div>
                    <div class="stat-value" id="peak-speed">0 Mbps</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">传输时长</div>
                    <div class="stat-value" id="test-duration">0s</div>
                </div>
            </div>

            <div class="chart-container">
                <canvas id="speedChart"></canvas>
            </div>

            <div class="console-output" id="tp-log-output"></div>
        </div>

        <!-- 在文件传输选项卡的发送端区域添加UDT配置 -->
        <div id="transfer" class="tab-pane">
            <h2>局域网文件传输</h2>

            <div class="tp-controls">
                <div class="card">
                    <h3>📥 接收端 (Server)</h3>
                    <div class="form-control">
                        <label for="transfer-save-path">保存路径</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="transfer-save-path" readonly placeholder="点击选择保存目录">
                            <button class="btn-secondary" onclick="selectSavePath()" style="padding: 8px 16px;">浏览
                            </button>
                        </div>
                    </div>
                    <button class="btn-secondary" onclick="startTransferServer()">启动接收服务 (Port 5202)</button>
                    <p id="transfer-server-status" class="status-text">
                        <span class="status-indicator inactive"></span>未启动
                    </p>
                </div>

                <!-- 在文件传输选项卡的发送端区域 -->
                <div class="card">
                    <h3>📤 发送端 (Client)</h3>
                    <div class="form-control">
                        <label for="transfer-target-ip">目标 IP</label>
                        <input type="text" id="transfer-target-ip" placeholder="如 192.168.1.1" value="127.0.0.1">
                    </div>
                    <div class="form-control">
                        <label for="transfer-protocol">传输协议</label>
                        <select id="transfer-protocol" class="protocol-select">
                            <option value="tcp">TCP (默认)</option>
                            <option value="hpr-udp">HPR-UDP (高性能)</option>
                        </select>
                    </div>

                    <!-- HPR-UDP配置区域 -->
                    <div id="udt-config" class="udt-config-panel">
                        <h4>HPR-UDP 高级配置</h4>
                        <div class="udt-config-grid">
                            <div class="form-control">
                                <label for="udt-window-size">滑动窗口大小</label>
                                <input type="number" id="udt-window-size" value="32768" min="1000" max="100000">
                                <small>建议: 32768-65536</small>
                            </div>
                            <div class="form-control">
                                <label for="udt-packet-size">数据包大小 (字节)</label>
                                <input type="number" id="udt-packet-size" value="8192" min="1000" max="16384">
                                <small>建议: 4096-8192</small>
                            </div>
                            <div class="form-control">
                                <label for="udt-rto">重传超时 (ms)</label>
                                <input type="number" id="udt-rto" value="100" min="50" max="1000" step="50">
                                <small>建议: 100-500ms</small>
                            </div>
                        </div>
                        <div class="udt-info">
                            <div class="udt-info-title">💡 HPR-UDP 说明</div>
                            <div class="udt-info-content">
                                1. 提供可靠的高速文件传输<br>
                                2. 适合大文件传输（100MB以上）<br>
                                3. 自动重传、流量控制、拥塞控制<br>
                                4. 支持MD5校验确保文件完整性
                            </div>
                        </div>
                    </div>

                    <div class="form-control">
                        <label>选择文件</label>
                        <div class="file-select-row">
                            <input type="text" id="transfer-file-display" readonly placeholder="点击选择文件">
                            <button class="btn-secondary" onclick="triggerFileSelect()">浏览</button>
                        </div>
                    </div>
                    <button class="btn-primary" id="btn-send-file" onclick="sendFile()">发送文件</button>
                </div>
            </div>

            <div id="transfer-progress" class="transfer-progress" style="display: none;">
                <div class="progress-info">
                    <span id="transfer-progress-text">准备传输...</span>
                    <span id="transfer-progress-percent">0%</span>
                </div>
                <div class="progress-bar-container">
                    <div id="transfer-progress-bar" class="progress-bar"></div>
                </div>
                <div style="margin-top: 10px; display: flex; justify-content: space-between; font-size: 13px; color: var(--text-muted);">
                    <span>速度: <span id="transfer-speed">0 MB/s</span></span>
                    <span>已传输: <span id="transfer-bytes">0 MB</span> / <span id="transfer-total">0 MB</span></span>
                    <span>剩余时间: <span id="transfer-eta">--:--</span></span>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">当前文件</div>
                    <div class="stat-value" id="current-file" style="font-size: 16px; word-break: break-all;">--</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">文件大小</div>
                    <div class="stat-value" id="file-size">0 MB</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">源文件 MD5</div>
                    <div class="stat-value" id="source-md5"
                         style="font-size: 14px; font-family: 'Consolas', monospace;">--
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">接收文件 MD5</div>
                    <div class="stat-value" id="received-md5"
                         style="font-size: 14px; font-family: 'Consolas', monospace;">--
                    </div>
                </div>
            </div>

            <div id="md5-result"
                 style="display: none; padding: 15px; border-radius: 10px; margin: 20px 0; text-align: center; font-weight: 600; font-size: 16px;">
            </div>

            <div class="device-list-container">
                <div class="device-list-header">
                    <h3>传输历史 (<span id="transfer-history-count">0</span>)</h3>
                    <button class="btn-secondary" onclick="clearTransferHistory()"
                            style="padding: 8px 16px; font-size: 13px;">
                        🗑️ 清空历史
                    </button>
                </div>
                <div class="device-table-wrapper">
                    <table class="device-table">
                        <thead>
                        <tr>
                            <th style="width: 40px;">#</th>
                            <th style="width: 80px;">类型</th>
                            <th>文件名</th>
                            <th style="width: 100px;">大小</th>
                            <th style="width: 150px;">对方IP</th>
                            <th style="width: 80px;">协议</th>
                            <th style="width: 100px;">耗时</th>
                            <th style="width: 80px;">状态</th>
                            <th style="width: 120px;">时间</th>
                        </tr>
                        </thead>
                        <tbody id="transfer-history">
                        <tr>
                            <td colspan="9" style="text-align: center; color: var(--text-muted); padding: 40px;">
                                暂无传输记录
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="console-output" id="transfer-log-output"></div>
        </div>
    </div>
</div>
<script src="renderer.js"></script>
</body>
</html>