<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NetTestTool Pro - 专业网络测试工具</title>
    <link rel="stylesheet" href="./styles.css">
    <script src="./chart.js"></script>
</head>
<body>

<div class="app-container">
    <!-- 侧边栏导航 -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <span class="logo-icon">🚀</span>
                <span class="logo-text">NetTest Pro</span>
            </div>
            <div class="version">v1.5.0 <span class="badge badge-hruft">HRUFT</span></div>
        </div>

        <nav class="nav-menu">
            <div class="nav-item active" onclick="showTab('info')" data-tab="info">
                <span class="nav-icon">📊</span>
                <span class="nav-text">网络信息</span>
            </div>
            <div class="nav-item" onclick="showTab('ping')" data-tab="ping">
                <span class="nav-icon">⚡</span>
                <span class="nav-text">Ping 测试</span>
            </div>
            <div class="nav-item" onclick="showTab('scan')" data-tab="scan">
                <span class="nav-icon">🔍</span>
                <span class="nav-text">网段扫描</span>
            </div>
            <div class="nav-item" onclick="showTab('throughput')" data-tab="throughput">
                <span class="nav-icon">📈</span>
                <span class="nav-text">吞吐量测试</span>
            </div>
            <div class="nav-item" onclick="showTab('transfer')" data-tab="transfer">
                <span class="nav-icon">📂</span>
                <span class="nav-text">文件传输</span>
            </div>
        </nav>

        <div class="sidebar-footer">
            <div class="status-indicator">
                <span class="status-dot"></span>
                <span class="status-text">系统就绪</span>
            </div>
        </div>
    </aside>

    <!-- 主内容区 -->
    <main class="content">

        <!-- ===== 网络信息模块 ===== -->
        <section id="info" class="module-section active">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="title-icon">🌐</span>
                    系统网络接口
                </h2>
                <button class="btn btn-primary" onclick="NetworkInfoModule.loadInterfaces()">
                    <span>🔄</span> 刷新状态
                </button>
            </div>
            <div id="interface-list" class="card-grid"></div>
        </section>

        <!-- ===== Ping 测试模块 ===== -->
        <section id="ping" class="module-section">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="title-icon">⚡</span>
                    延迟测试 (ICMP Ping)
                </h2>
            </div>

            <div class="card config-card">
                <div class="config-row">
                    <div class="input-group flex-2">
                        <label>目标地址</label>
                        <input type="text" id="ping-target" value="8.8.8.8" placeholder="IP 或域名">
                    </div>
                    <div class="input-group flex-1">
                        <label>间隔 (秒)</label>
                        <input type="number" id="ping-interval" value="1" min="0.1" step="0.1">
                    </div>
                    <div class="input-group flex-1">
                        <label>包大小 (字节)</label>
                        <input type="number" id="ping-size" value="32" min="1" max="65500">
                    </div>
                    <button id="btn-ping" class="btn btn-success" onclick="togglePing()">
                        <span>▶</span> 开始测试
                    </button>
                </div>
            </div>

            <div class="chart-card">
                <div class="chart-header">
                    <h3>实时延迟图表</h3>
                    <div class="chart-stats">
                        <span id="ping-avg">平均: - ms</span>
                        <span id="ping-min">最小: - ms</span>
                        <span id="ping-max">最大: - ms</span>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="pingChart"></canvas>
                </div>
            </div>

            <div class="console-card">
                <div class="console-header">
                    <span>📄 日志输出</span>
                    <button class="btn-icon" onclick="clearConsole('ping-output')">清空</button>
                </div>
                <div class="console-output" id="ping-output"></div>
            </div>
        </section>

        <!-- ===== 网段扫描模块 ===== -->
        <section id="scan" class="module-section">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="title-icon">🔍</span>
                    在线设备扫描
                </h2>
            </div>

            <div class="card config-card">
                <div class="config-row">
                    <div class="input-group flex-2">
                        <label>扫描网段</label>
                        <select id="scan-interface"></select>
                    </div>
                    <div class="input-group flex-1">
                        <label>超时 (ms)</label>
                        <input type="number" id="scan-timeout" value="200" min="50" max="5000">
                    </div>
                    <button id="btn-scan" class="btn btn-success" onclick="toggleScan()">
                        <span>🔎</span> 开始扫描
                    </button>
                </div>
            </div>

            <div id="scan-progress" class="progress-card" style="display:none">
                <div class="progress-info">
                    <span id="scan-progress-text">初始化中...</span>
                    <span id="scan-progress-percent">0%</span>
                </div>
                <div class="progress-bar-bg">
                    <div id="scan-progress-bar" class="progress-bar-fill"></div>
                </div>
            </div>

            <div class="table-card">
                <div class="table-header">
                    <h3>发现的设备</h3>
                    <span id="device-count" class="badge">0 台</span>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                        <tr>
                            <th>IP 地址</th>
                            <th>MAC 地址</th>
                            <th>厂商 (OUI)</th>
                            <th>响应时间</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody id="device-list"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- ===== 吞吐量测试模块 (iPerf) ===== -->
        <section id="throughput" class="module-section">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="title-icon">📈</span>
                    带宽吞吐量测试 (iPerf)
                </h2>
                <div class="mode-switch">
                    <button class="mode-btn active" onclick="switchTpMode('server')" data-mode="server">
                        服务端
                    </button>
                    <button class="mode-btn" onclick="switchTpMode('client')" data-mode="client">
                        客户端
                    </button>
                </div>
            </div>

            <!-- 服务端控制 -->
            <div id="tp-server-controls" class="card config-card">
                <div class="config-row">
                    <div class="input-group flex-1">
                        <label>监听端口</label>
                        <input type="number" id="tp-server-port" value="5201">
                    </div>
                    <div class="input-group flex-1">
                        <label>协议</label>
                        <select id="tp-server-protocol">
                            <option value="tcp">TCP</option>
                            <option value="udp">UDP</option>
                        </select>
                    </div>
                    <div class="input-group flex-1">
                        <label>iPerf 版本</label>
                        <select id="tp-server-version">
                            <option value="iperf2">iPerf 2</option>
                        </select>
                    </div>
                    <button id="btn-tp-server" class="btn btn-success" onclick="toggleTpServer()">
                        <span>🎯</span> 启动服务
                    </button>
                </div>
            </div>

            <!-- 客户端控制 -->
            <div id="tp-client-controls" class="card config-card" style="display:none">
                <div class="config-row">
                    <div class="input-group flex-2">
                        <label>目标服务器</label>
                        <input type="text" id="tp-client-ip" placeholder="192.168.x.x">
                    </div>
                    <div class="input-group flex-1">
                        <label>端口</label>
                        <input type="number" id="tp-client-port" value="5201">
                    </div>
                    <div class="input-group flex-1">
                        <label>协议</label>
                        <select id="tp-client-protocol">
                            <option value="tcp">TCP</option>
                            <option value="udp">UDP</option>
                        </select>
                    </div>
                </div>
                <div class="config-row">
                    <div class="input-group flex-1">
                        <label>测试时长 (秒)</label>
                        <input type="number" id="tp-client-duration" value="10" min="1">
                    </div>
                    <div class="input-group flex-1">
                        <label>带宽 (Mbps, UDP)</label>
                        <input type="number" id="tp-client-bandwidth" value="100">
                    </div>
                    <div class="input-group flex-1">
                        <label>iPerf 版本</label>
                        <select id="tp-client-version">
                            <option value="iperf2">iPerf 2</option>
                        </select>
                    </div>
                    <button id="btn-tp-client" class="btn btn-success" onclick="toggleTpClient()">
                        <span>🚀</span> 开始测试
                    </button>
                </div>
            </div>

            <div class="console-card">
                <div class="console-header">
                    <span>📄 iPerf 输出</span>
                    <button class="btn-icon" onclick="clearConsole('tp-log')">清空</button>
                </div>
                <div class="console-output" id="tp-log"></div>
            </div>

            <div class="chart-card">
                <div class="chart-header">
                    <h3>实时吞吐量</h3>
                    <div class="chart-stats">
                        <span id="tp-current">当前: 0 Mbps</span>
                        <span id="tp-avg">平均: 0 Mbps</span>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="tpChart"></canvas>
                </div>
            </div>


        </section>

        <!-- ===== 文件传输模块 (HRUFT) ===== -->
        <section id="transfer" class="module-section">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="title-icon">📂</span>
                    高性能文件传输
                </h2>
                <div class="mode-switch">
                    <button class="mode-btn active" onclick="switchTransferMode('send')" data-mode="send">
                        发送文件
                    </button>
                    <button class="mode-btn" onclick="switchTransferMode('receive')" data-mode="receive">
                        接收文件
                    </button>
                </div>
            </div>

            <!-- 发送端控制 -->
            <div id="send-controls" class="card config-card">
                <div class="config-row">
                    <div class="input-group flex-2">
                        <label>目标 IP 地址</label>
                        <input type="text" id="transfer-target-ip" placeholder="192.168.x.x">
                    </div>
                    <div class="input-group flex-1">
                        <label>端口</label>
                        <input type="number" id="transfer-target-port" value="5202">
                    </div>
                    <div class="input-group flex-1">
                        <label>传输协议</label>
                        <select id="transfer-protocol" onchange="toggleUdtConfig()">
                            <option value="hruft">HRUFT (UDP)</option>
                            <option value="tcp">标准 TCP</option>
                        </select>
                    </div>
                </div>

                <div id="udt-config" class="sub-config">
                    <h4>HRUFT 高级配置</h4>
                    <div class="config-row">
                        <div class="input-group">
                            <label>MSS (报文大小)</label>
                            <input type="number" id="udt-packet-size" value="1400" min="512" max="9000">
                        </div>
                        <div class="input-group">
                            <label>窗口大小 (MB)</label>
                            <input type="number" id="udt-window-size" value="1" min="1" max="100">
                        </div>
                    </div>
                </div>

                <div class="file-selector">
                    <input type="text" id="transfer-file-display" readonly placeholder="请选择要发送的文件...">
                    <button class="btn btn-secondary" onclick="triggerFileSelect()">
                        📁 选择文件
                    </button>
                </div>

                <div class="action-bar">
                    <button class="btn btn-success btn-large" onclick="sendFile()">
                        🚀 立即发送
                    </button>
                </div>
            </div>

            <!-- 接收端控制 -->
            <div id="receive-controls" class="card config-card" style="display:none">
                <div class="config-row">
                    <div class="input-group flex-1">
                        <label>监听端口</label>
                        <input type="number" id="transfer-recv-port" value="5202">
                    </div>
                    <div class="input-group flex-1">
                        <label>接收协议</label>
                        <select id="transfer-recv-protocol">
                            <option value="hruft">HRUFT (UDP)</option>
                            <option value="tcp">标准 TCP</option>
                        </select>
                    </div>
                </div>
                <div class="file-selector">
                    <input type="text" id="transfer-save-path" readonly placeholder="请选择保存目录...">
                    <button class="btn btn-secondary" onclick="selectSavePath()">
                        📁 更改目录
                    </button>
                </div>
                <div class="action-bar">
                    <button id="btn-recv-server" class="btn btn-success btn-large" onclick="startTransferServer()">
                        🎯 开启接收服务
                    </button>
                </div>
            </div>

            <!-- 传输进度显示 -->
            <div id="transfer-progress" class="transfer-status-zone" style="display:none">
                <div class="status-header">
                    <span id="transfer-status-text" class="status-text">就绪</span>
                    <span id="transfer-speed" class="speed-text">0 MB/s</span>
                </div>
                <div class="progress-bar-bg">
                    <div id="transfer-progress-bar" class="progress-bar-fill accent"></div>
                </div>
                <div class="status-footer">
                    <span id="transfer-bytes">0 / 0 MB</span>
                    <span id="transfer-eta">剩余时间: --</span>
                </div>
            </div>

            <div class="console-card mt-20">
                <div class="console-header">
                    <span>📄 传输日志</span>
                    <button class="btn-icon" onclick="clearConsole('transfer-log-output')">清空</button>
                </div>
                <div class="console-output" id="transfer-log-output"></div>
            </div>
        </section>

    </main>
</div>

<script src="./renderer.js"></script>
</body>
</html>